---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getGlobalSettings, getWorks } from "../../lib/microcms";

const [settings, works] = await Promise.all([
  getGlobalSettings(),
  getWorks(),
]);

const categories = ["All", "Tapestry", "Soft Sculpture", "Social Art", "Project"];
---

<BaseLayout title="作品" settings={settings}>
  <!-- Title Section -->
  <section class="pt-24 pb-12 px-6 md:px-20 bg-background-light dark:bg-background-dark">
    <div class="flex flex-col gap-10">
      <div class="flex flex-col gap-2">
        <h2 class="font-serif text-4xl md:text-5xl font-light text-text-main dark:text-white tracking-wider">作品集</h2>
        <span class="text-xs text-primary font-medium tracking-[0.2em] uppercase opacity-80 pl-1">Selected Works</span>
      </div>
      <!-- Category Filter -->
      <div class="flex flex-wrap gap-x-8 gap-y-4 border-b border-gray-200 dark:border-gray-800 pb-6">
        {categories.map((cat, i) => (
          <button
            class={`text-sm font-medium pb-1 transition-all tracking-wider ${
              i === 0
                ? "font-bold text-primary border-b-2 border-primary"
                : "text-text-muted hover:text-primary hover:border-b-2 hover:border-primary/50"
            }`}
          >
            {cat === "All" ? "すべて (All)" : cat}
          </button>
        ))}
      </div>
    </div>
  </section>

  <!-- Works Grid -->
  <section class="pb-24 px-6 md:px-20 bg-background-light dark:bg-background-dark min-h-screen">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-10 gap-y-20">
      {works.map((work, i) => (
        <article class={`group cursor-pointer flex flex-col gap-4 ${i % 3 === 1 ? "mt-0 md:mt-12" : ""}`}>
          <a href={`/works/${work.slug}`} class="relative overflow-hidden aspect-[4/5] bg-gray-100 rounded-sm block">
            <div
              class="absolute inset-0 bg-cover bg-center transition-all duration-700 ease-in-out z-10"
              style={`background-image: url("${work.main_image.url}?w=600&q=80");`}
            />
            {work.gallery && work.gallery[0] && (
              <div
                class="absolute inset-0 bg-cover bg-center transition-all duration-700 ease-in-out z-20 opacity-0 group-hover:opacity-100 scale-110 group-hover:scale-100"
                style={`background-image: url("${work.gallery[0].url}?w=600&q=80");`}
              >
                <div class="absolute inset-0 bg-black/10"></div>
              </div>
            )}
          </a>
          <div class="flex justify-between items-start pt-2 border-t border-transparent group-hover:border-gray-200 dark:group-hover:border-gray-800 transition-colors duration-500">
            <div class="flex flex-col gap-1">
              <a href={`/works/${work.slug}`}>
                <h3 class="font-serif text-xl text-text-main dark:text-white group-hover:text-primary transition-colors">{work.title}</h3>
              </a>
              <p class="text-xs text-text-muted font-light tracking-wide">{work.material}</p>
            </div>
            <div class="flex flex-col items-end gap-1">
              <span class="text-xs font-mono text-text-muted">{work.year}</span>
              <span class="text-[10px] uppercase tracking-widest text-primary bg-primary/5 px-2 py-0.5 rounded-full">{work.category}</span>
            </div>
          </div>
        </article>
      ))}
    </div>
  </section>
</BaseLayout>
