---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getGlobalSettings, getResearch } from "../../lib/microcms";

const [settings, projects] = await Promise.all([
  getGlobalSettings(),
  getResearch(),
]);

const categories = ["All", "Material Study", "Philosophy", "Field Work"];
const base = import.meta.env.BASE_URL.replace(/\/$/, "");
---

<BaseLayout title="プロジェクト" settings={settings}>
  <!-- Title Section -->
  <section class="pt-24 pb-12 px-6 md:px-20 bg-background-light dark:bg-background-dark">
    <div class="flex flex-col gap-10">
      <div class="flex flex-col gap-2">
        <h2 class="font-serif text-4xl md:text-5xl font-light text-text-main dark:text-white tracking-wider">プロジェクト一覧</h2>
        <span class="text-xs text-primary font-medium tracking-[0.2em] uppercase opacity-80 pl-1">Projects Archive</span>
      </div>
      <!-- Category Filter -->
      <div class="flex flex-wrap gap-x-8 gap-y-4 border-b border-gray-200 dark:border-gray-800 pb-6">
        {categories.map((cat, i) => (
          <button
            class={`text-sm font-medium pb-1 transition-all tracking-wider ${
              i === 0
                ? "font-bold text-primary border-b-2 border-primary"
                : "text-text-muted hover:text-primary hover:border-b-2 hover:border-primary/50"
            }`}
          >
            {cat === "All" ? "すべて (All)" : cat}
          </button>
        ))}
      </div>
    </div>
  </section>

  <!-- Projects Grid -->
  <section class="pb-24 px-6 md:px-20 bg-background-light dark:bg-background-dark min-h-screen">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-10 gap-y-20">
      {projects.map((project, i) => (
        <article class={`group cursor-pointer flex flex-col gap-4 ${i % 3 === 1 ? "mt-0 md:mt-12" : ""}`}>
          <a href={`${base}/projects/${project.id}`} class="relative overflow-hidden aspect-[4/5] bg-gray-100 rounded-sm block">
            {project.main_image ? (
              <div
                class="absolute inset-0 bg-cover bg-center transition-all duration-700 ease-in-out z-10"
                style={`background-image: url("${project.main_image.url}?w=600&q=80");`}
              />
            ) : (
              <div class="absolute inset-0 flex items-center justify-center bg-gray-100 dark:bg-gray-800 z-10">
                <span class="text-xs text-gray-400 dark:text-gray-500 tracking-wider">画像準備中</span>
              </div>
            )}
          </a>
          <div class="flex justify-between items-start pt-2 border-t border-transparent group-hover:border-gray-200 dark:group-hover:border-gray-800 transition-colors duration-500">
            <div class="flex flex-col gap-1">
              <a href={`${base}/projects/${project.id}`}>
                <h3 class="font-serif text-xl text-text-main dark:text-white group-hover:text-primary transition-colors">{project.title}</h3>
              </a>
              {project.summary && (
                <p class="text-xs text-text-muted font-light tracking-wide line-clamp-1">{project.summary}</p>
              )}
            </div>
            <div class="flex flex-col items-end gap-1">
              {project.year && <span class="text-xs font-mono text-text-muted">{project.year}</span>}
              {project.category && (
                <span class="text-[10px] uppercase tracking-widest text-primary bg-primary/5 px-2 py-0.5 rounded-full">{project.category}</span>
              )}
            </div>
          </div>
        </article>
      ))}
    </div>
  </section>
</BaseLayout>
