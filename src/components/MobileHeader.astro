---
import type { GlobalSettings } from "../types/microcms";

interface Props {
  settings: GlobalSettings;
}

const { settings } = Astro.props;
const base = import.meta.env.BASE_URL.replace(/\/$/, "");

const navItems = [
  { href: `${base}/about`, icon: "person", label: "作家について (About)" },
  { href: `${base}/news`, icon: "newspaper", label: "最新情報 (News)" },
  { href: `${base}/works`, icon: "grid_view", label: "作品 (Works)" },
  { href: `${base}/projects`, icon: "folder_special", label: "プロジェクト (Projects)" },
  { href: `${base}/contact`, icon: "mail", label: "お問い合わせ (Contact)" },
];
---

<header class="md:hidden flex items-center justify-between p-6 bg-background-light/90 dark:bg-background-dark/90 sticky top-0 z-50 backdrop-blur-sm border-b border-gray-200 dark:border-gray-800">
  <a href={`${base}/`} class="flex flex-col min-w-0">
    <h1 class="font-serif text-lg font-bold tracking-wider text-text-main dark:text-white truncate">{settings.artist_name}</h1>
    <span class="text-xs text-primary uppercase tracking-widest mt-1 truncate">{settings.artist_subtitle}</span>
  </a>
  <button class="p-2 text-text-main dark:text-white" id="mobile-menu-btn" aria-label="メニューを開く">
    <span class="material-symbols-outlined">menu</span>
  </button>
</header>

<!-- Mobile Menu Panel -->
<div id="mobile-menu" class="fixed inset-0 z-[60] translate-x-full transition-transform duration-300 ease-in-out md:hidden">
  <!-- Backdrop -->
  <div id="mobile-menu-backdrop" class="absolute inset-0 bg-black/30 opacity-0 transition-opacity duration-300"></div>
  <!-- Menu Panel -->
  <nav class="absolute right-0 top-0 bottom-0 w-4/5 max-w-sm bg-background-light dark:bg-background-dark flex flex-col p-10 shadow-2xl">
    <!-- Close Button -->
    <div class="flex justify-end mb-12">
      <button id="mobile-menu-close" class="p-2 text-text-main dark:text-white" aria-label="メニューを閉じる">
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>
    <!-- Nav Items -->
    <div class="flex flex-col gap-8 flex-1">
      {navItems.map((item) => (
        <a class="mobile-menu-link flex items-center gap-4 text-text-muted hover:text-primary transition-colors duration-300" href={item.href}>
          <span class="material-symbols-outlined text-[20px] font-light">{item.icon}</span>
          <span class="text-sm font-medium tracking-wide">{item.label}</span>
        </a>
      ))}
    </div>
    <!-- SNS -->
    <div class="flex items-center gap-4 pt-8 border-t border-gray-200 dark:border-gray-800">
      {settings.instagram_url && (
        <a class="group flex flex-col items-center gap-2" href={settings.instagram_url} target="_blank" rel="noopener noreferrer">
          <div class="w-11 h-11 rounded-xl border border-gray-300 dark:border-gray-600 flex items-center justify-center transition-colors duration-300 group-hover:border-primary">
            <img src={`${base}/icons/instagram.png`} alt="Instagram" class="block w-4 h-4 opacity-50 transition-opacity duration-300 group-hover:opacity-100" />
          </div>
        </a>
      )}
      {settings.x_url && (
        <a class="group flex flex-col items-center gap-2" href={settings.x_url} target="_blank" rel="noopener noreferrer">
          <div class="w-11 h-11 rounded-xl border border-gray-300 dark:border-gray-600 flex items-center justify-center transition-colors duration-300 group-hover:border-primary">
            <img src={`${base}/icons/x.png`} alt="X" class="block w-4 h-4 opacity-50 transition-opacity duration-300 group-hover:opacity-100" />
          </div>
        </a>
      )}
    </div>
  </nav>
</div>

<script>
  const btn = document.getElementById("mobile-menu-btn");
  const menu = document.getElementById("mobile-menu");
  const backdrop = document.getElementById("mobile-menu-backdrop");
  const closeBtn = document.getElementById("mobile-menu-close");
  const links = document.querySelectorAll(".mobile-menu-link");

  function openMenu() {
    menu?.classList.remove("translate-x-full");
    menu?.classList.add("translate-x-0");
    backdrop?.classList.remove("opacity-0");
    backdrop?.classList.add("opacity-100");
    document.body.style.overflow = "hidden";
  }

  function closeMenu() {
    menu?.classList.remove("translate-x-0");
    menu?.classList.add("translate-x-full");
    backdrop?.classList.remove("opacity-100");
    backdrop?.classList.add("opacity-0");
    document.body.style.overflow = "";
  }

  btn?.addEventListener("click", openMenu);
  closeBtn?.addEventListener("click", closeMenu);
  backdrop?.addEventListener("click", closeMenu);
  links.forEach((link) => link.addEventListener("click", closeMenu));
</script>
